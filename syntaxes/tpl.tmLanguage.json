{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Zotonic",
	"scopeName": "source.tpl",
	"injections": {
		"L:meta.tag, L:source.css, L:source.js, L:meta.block.js, L:string - (string.quoted.double.trans.tpl)": {
			"patterns": [
				{
					"include": "#tpl-stuff"
				}
			]
		}
	},
	"patterns": [
		{
			"include": "text.html.tpl"
		},
		{
			"include": "#js"
		},
		{
			"include": "#tpl-stuff"
		}
	],
	"repository": {
		"js": {
			"patterns": [
				{
					"begin": "(?<={%\\s*javascript\\s*%})",
					"end": ".*?(?={%\\s*endjavascript\\s*%})",
					"patterns": [
						{
							"include": "#comments"
						},
						{
							"include": "source.js.tpl"
						}
					]
				}
			]
		},
		"comments": {
			"patterns": [
				{
					"name": "comment.line.tpl",
					"begin": "{#",
					"end": "#}"
				},
				{
					"name": "comment.block.tpl",
					"begin": "(?={%\\s*comment\\s*%})",
					"end": ".*?(?:{%\\s*endcomment\\s*%})"
				}
			]
		},
		"tags": {
			"patterns": [
				{
					"name": "tag.tpl",
					"contentName": "tag.body.tpl",
					"begin": "({%)\\s*",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.tag.begin.tpl"
						}
					},
					"end": "%}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.tag.end.tpl"
						}
					},
					"patterns": [
						{
							"begin": "\\b(trans)\\b",
							"beginCaptures": {
								"0": {
									"name": "entity.name.built-in.tag.tpl"
								}
							},
							"end": "(?=%})",
							"patterns": [
								{
									"begin": "\"",
									"end": "\"",
									"name": "string.quoted.double.trans.tpl",
									"patterns": [
										{
											"name": "constant.character.escape.trans.tpl",
											"match": "\\\\."
										},
										{
											"begin": "({){",
											"beginCaptures": {
												"1": {
													"name": "markup.deleted"
												}
											},
											"end": "}(})",
											"endCaptures": {
												"1": {
													"name": "markup.deleted"
												}
											}
										},
										{
											"begin": "{",
											"beginCaptures": {
												"0": {
													"name": "punctuation.definition.variable.begin.tpl"
												}
											},
											"end": "}",
											"endCaptures": {
												"0": {
													"name": "punctuation.definition.variable.end.tpl"
												}
											},
											"contentName": "variable.name.tpl"
										}
									]
								}
							]
						},
						{
							"begin": "\\b(wire)\\b",
							"beginCaptures": {
								"0": {
									"name": "entity.name.built-in.tag.tpl"
								}
							},
							"end": "(?=%})",
							"patterns": [
								{
									"name": "keyword.argument.wire.tpl",
									"match": "\\b(id|type|propagate|target|action|postback|delegate)\\b"
								},
								{
									"include": "#wire-actions"
								},
								{
									"include": "#keywords"
								},
								{
									"include": "#strings"
								}
							]
						},
						{
							"include": "#entities"
						},
						{
							"include": "#keywords"
						},
						{
							"include": "#strings"
						}
					]
				}
			]
		},
		"variables": {
			"patterns": [
				{
					"name": "variable.tpl",
					"begin": "{{",
					"beginCaptures": {
						"0": {
							"name": "punctuation.definition.variable.begin.tpl"
						}
					},
					"end": "}}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.variable.end.tpl"
						}
					},
					"patterns": [
						{
							"include": "#keywords"
						},
						{
							"include": "#strings"
						},
						{
							"patterns": [
								{
									"match": "(?<=\\|)\\w+",
									"captures": {
										"0": {
											"patterns": [
												{
													"include": "#keywords"
												}
											]
										}
									}
								}
							]
						}
					]
				}
			]
		},
		"tpl-stuff": {
			"patterns": [
				{
					"include": "#comments"
				},
				{
					"include": "#tags"
				},
				{
					"include": "#variables"
				}
			]
		},
		"entities": {
			"patterns": [
				{
					"name": "entity.name.built-in.tag.tpl",
					"match": "\\b(all catinclude|all include|autoescape|block|cache|call|catinclude|comment|cycle|extends|filter|firstof|for|if|ifchanged|ifequal|ifnotequal|image|image_data_url|image_url|include|inherit|javascript|lib|load|media|now|overrules|print|raw|regroup|spaceless|templatetag|translate|trans|url|with)\\b"
				},
				{
					"name": "entity.name.built-in.end.tag.tpl",
					"match": "\\b(empty|endfor|endblock|endautoescape|else|elif|elseif|endif|endcomment|endifequal|endifnotequal|endspaceless|endwith|endcache|endfilter|endjavascript)\\b"
				},
				{
					"name": "entity.name.module.tag.tpl",
					"match": "\\b(button|chart_pie|chart_pie3d|cotonic_pathname_search|debug|draggable|droppable|google_chart|inplace_textbox|lazy|live|loremipsum|mailinglist_subscribe|menu|pager|poll|script|sortable|sorter|spinner|tabs|validate|wire|wire_args|worker)\\b"
				}
			]
		},
		"keywords": {
			"patterns": [
				{
					"name": "keyword.base.filter.tpl",
					"match": "\\b(add_day|make_list|add_hour|make_value|add_month|match|add_week|max|add_year|md5|after|member|append|min|as_atom|minmax|before|ne_day|brlinebreaks|nthtail|capfirst|parse_url|center|pickle|chunk|pprint|content_type_label|rand|content_type_urls|random|datediff|randomize|date|range|date_range|replace_args|element|replace|embedded_media|reversed|eq_day|rjust|escape_check|round|escape|sanitize_html|escape_ical|sanitize_url|escapejs|sha1|escapejson|show_media|escape_link|slice|escapexml|slugify|exclude|sort|filesizeformat|split|filter|split_in|first|stringify|fix_ampersands|striptags|flatten_value|sub_day|force_escape|sub_hour|format_duration|sub_month|format_integer|sub_week|format_number|sub_year|format_price|summary|group_by|tail|group_firstchar|timesince|group_title_firstchar|to_binary|if|toc|if_undefined|to_integer|index_of|to_json|in_future|tokens|in_past|to_name|insert|trans_filled|is_a|trim|is_defined|truncate|is_even|truncate_html|is_list|unescape|is_not_a|upper|is_number|url_abs|is_site_url|urlencode|is_undefined|url|is_visible|urlize|join|utc|last|vsplit_in|length|without_embedded_media|linebreaksbr|without|ljust|yesno|lower)\\b"
				},
				{
					"name": "keyword.operator.comparison.tpl",
					"match": "==|!=|<=|>=|<|>"
				},
				{
					"name": "keyword.operator.assignment.tpl",
					"match": "=|:|\\b(as)\\b"
				},
				{
					"name": "keyword.operator.arithmetic.tpl",
					"match": "\\-|\\+|\\*|/"
				},
				{
					"name": "keyword.operator.pipe.tpl",
					"match": "\\|"
				}
			]
		},
		"strings": {
			"name": "string.quoted.double.tpl",
			"begin": "\"",
			"end": "\"",
			"patterns": [
				{
					"name": "constant.character.escape.tpl",
					"match": "\\\\."
				}
			]
		},
		"wire-actions": {
			"begin": "(?<=\\saction=)({)\\s*",
			"beginCaptures": {
				"1": {
					"name": "punctuation.definition.action.begin.tpl"
				}
			},
			"end": "(?:})",
			"endCaptures": {
				"0": {
					"name": "punctuation.definition.action.end.tpl"
				}
			},
			"patterns": [
				{
					"include": "#wire-actions-args"
				},
				{
					"include": "#wire-postbacks"
				},
				{
					"include": "#keywords"
				},
				{
					"include": "#strings"
				}
			]
		},
		"wire-actions-args": {
			"patterns": [
				{
					"match": "\\b(with_args)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.actions.tpl"
						}
					}
				},
				{
					"match": "\\b(admin_tasks|redirect_incat)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.admin.tpl"
						}
					}
				},
				{
					"match": "\\b(module_rescan|module_toggle)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.admin.modules.tpl"
						}
					}
				},
				{
					"match": "\\b(backup_start)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.backup.tpl"
						}
					}
				},
				{
					"match": "\\b(config_delete|config_toggle|dialog_config_delete|dialog_config_edit|dialog_config_new)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.config.tpl"
						}
					}
				},
				{
					"match": "\\b(development_templates_stream)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.development.tpl"
						}
					}
				},
				{
					"match": "\\b(dialog|dialog_open|dialog_close|overlay_open|overlay_close)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.dialog.tpl"
						}
					}
				},
				{
					"match": "\\b(add_class|animate|buttonize|effect|fade_in|fade_out|hide|insert_after|insert_before|insert_bottom|insert_top|jquery_effect|mask|mask_progress|move|remove|remove_class|replace|set_class|show|slide_down|slide_fade_in|slide_fade_out|slide_toggle|slide_up|toggle|toggle_class|unmask|update|update_iframe|Editor|editor_add|editor_remove|zlink|zmedia|zmedia_choose|zmedia_has_chosen)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.dom.tpl"
						}
					}
				},
				{
					"match": "\\b(notify|postback|trigger_event|publish)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.event.tpl"
						}
					}
				},
				{
					"match": "\\b(disable|enable|event|focus|form_reset|reset|set_value|submit|typeselect|validation_error)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.form.tpl"
						}
					}
				},
				{
					"match": "\\b(script)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.js.tpl"
						}
					}
				},
				{
					"match": "\\b(dialog_mail_page|dialog_mailing_page|mailing_page_test|mailinglist_confirm|mailinglist_unsubscribe)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.mail.tpl"
						}
					}
				},
				{
					"match": "\\b(alert|confirm|growl)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.notification.tpl"
						}
					}
				},
				{
					"match": "\\b(redirect|reload)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.page-handling.tpl"
						}
					}
				},
				{
					"match": "\\b(dialog_predicate_new|link|unlink)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.predicate.tpl"
						}
					}
				},
				{
					"match": "\\b(delete_media|delete_rsc|dialog_delete_rsc|dialog_duplicate_rsc|dialog_edit_basics|dialog_media_upload|dialog_new_rsc)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.rsc.tpl"
						}
					}
				},
				{
					"match": "\\b(moreresults)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.search.tpl"
						}
					}
				},
				{
					"match": "\\b(template)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.template.tpl"
						}
					}
				},
				{
					"match": "\\b(auth_disconnect|delete_username|dialog_delete_username|dialog_set_username_password|dialog_user_add|logoff)\\b",
					"captures": {
						"0": {
							"name": "entity.name.action.tag.user.tpl"
						}
					}
				}
			]
		},
		"wire-postbacks": {
			"begin": "(?<=\\spostback=)({)\\s*",
			"beginCaptures": {
				"1": {
					"name": "punctuation.definition.postback.begin.tpl"
				}
			},
			"end": "(?:})",
			"endCaptures": {
				"0": {
					"name": "punctuation.definition.postback.end.tpl"
				}
			},
			"patterns": [
				{
					"include": "#keywords"
				},
				{
					"include": "#strings"
				}
			]
		}
	}
}